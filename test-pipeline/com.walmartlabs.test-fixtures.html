<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>com.walmartlabs.test-fixtures documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">com.walmartlabs/test-fixtures</span> <span class="project-version">0.1-UNRELEASED</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="com.walmartlabs.test-fixtures.html"><div class="inner"><span>com.walmartlabs.test-fixtures</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-assoc-in-context"><div class="inner"><span>assoc-in-context</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-calls"><div class="inner"><span>calls</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-capture-logging"><div class="inner"><span>capture-logging</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-execute"><div class="inner"><span>execute</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-log-events"><div class="inner"><span>log-events</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-mock"><div class="inner"><span>mock</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-nextf"><div class="inner"><span>nextf</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-reporting"><div class="inner"><span>reporting</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-split"><div class="inner"><span>split</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-spy"><div class="inner"><span>spy</span></div></a></li><li class="depth-1"><a href="com.walmartlabs.test-fixtures.html#var-update-in-context"><div class="inner"><span>update-in-context</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">com.walmartlabs.test-fixtures</h1><div class="doc"><div class="markdown"><p>Per-test fixtures, including simple mocks and capturing of logging events.</p>
<p>A test is implemented as series of fixtures; each fixture receives a context map, does work, and passes the (sometimes modified) context map to the next fixture.</p>
<p>The goal is to make tests flatter (fewer nested scopes), more readable, and to make various kinds of fixtures more composable.</p></div></div><div class="public anchor" id="var-assoc-in-context"><h3>assoc-in-context</h3><div class="usage"><code>(assoc-in-context ks v)</code></div><div class="doc"><div class="markdown"><p>Returns a fixture that performs an <code>assoc-in</code> on the context during execution.</p></div></div></div><div class="public anchor" id="var-calls"><h3>calls</h3><h4 class="type">macro</h4><div class="usage"><code>(calls context spy-var)</code></div><div class="doc"><div class="markdown"><p>Returns calls to-date of the given spy, clearing the list of calls as a side effect.</p></div></div></div><div class="public anchor" id="var-capture-logging"><h3>capture-logging</h3><div class="usage"><code>(capture-logging context)</code></div><div class="doc"><div class="markdown"><p>Captures logging events from <code>clojure.tools.logging</code>.</p>
<p>Replaces the <code>*logger-factory*</code> with one that enables logging for all loggers and levels, and captures all log events to an atom. These events can be accessed via <a href="com.walmartlabs.test-fixtures.html#var-log-events">log-events</a>.</p>
<p>Each captured logging event is a map with the following keys:</p>
<ul>
  <li>:thread-name - String name of current thread</li>
  <li>:logger - String name of logger, e.g., “com.example.myapp.worker”</li>
  <li>:level - keyword of log level (:debug, :error, etc.)</li>
  <li>:throwable - instance of Throwable, or nil</li>
  <li>:message - String message</li>
</ul>
<p>Note that only logging using <code>clojure.tools.logging</code> are captured; logging to other frameworks (such logging from referenced Java libraries) are logged normally and not captured.</p></div></div></div><div class="public anchor" id="var-execute"><h3>execute</h3><div class="usage"><code>(execute &amp; fixtures)</code></div><div class="doc"><div class="markdown"><p>Executes a sequence of fixtures.</p>
<p>A fixture is responsible for one portion of setting up the test environment, and may perform part of the test execution as well. Generally, the final fixture is the most specific to a particular test, and will be where most assertions occur.</p>
<p>A fixture may be:</p>
<ul>
  <li>A fixture function</li>
  <li>nil (as a no-op fixture)</li>
  <li>a seq of fixtures</li>
</ul>
<p>A fixture is passed a context; the fixture’s job is to modify the context before passing the context to <code>nextf</code>; this call is often wrapped in a <code>try</code> (to clean up resources) and/or <code>with-redefs</code> (to override functions for testing).</p>
<p>Note that nils are allowed as no-op fixtures to make it easier to conditionally include fixtures using <code>when</code>. The provided seq of fixtures is flattened and nils are removed before constructing the chain of step functions.</p>
<p>Each fixture must call <a href="com.walmartlabs.test-fixtures.html#var-nextf">nextf</a> (except the final fixture, for which the call to <code>nextf</code> is optional and does nothing).</p></div></div></div><div class="public anchor" id="var-log-events"><h3>log-events</h3><div class="usage"><code>(log-events context)</code></div><div class="doc"><div class="markdown"><p>Returns all captured logging events, and clears the list of logging events as a side effect.</p></div></div></div><div class="public anchor" id="var-mock"><h3>mock</h3><h4 class="type">macro</h4><div class="usage"><code>(mock mock-var mock-fn)</code></div><div class="doc"><div class="markdown"><p>Returns a fixture that mocks the var with the corresponding function (as with <code>clojure.core/with-redefs</code>).</p></div></div></div><div class="public anchor" id="var-nextf"><h3>nextf</h3><div class="usage"><code>(nextf context)</code></div><div class="doc"><div class="markdown"><p>Called from a fixture function to pass the context to the next fixture function in the sequence. Does nothing if there are no more fixtures to execute.</p></div></div></div><div class="public anchor" id="var-reporting"><h3>reporting</h3><h4 class="type">macro</h4><div class="usage"><code>(reporting k)</code></div><div class="doc"><div class="markdown"><p>A fixture based on <code>com.walmartlabs.test-reporting/reporting</code> that extracts a value from the context and reports its value if a test fails.</p></div></div></div><div class="public anchor" id="var-split"><h3>split</h3><div class="usage"><code>(split fixture-fns)</code></div><div class="doc"><div class="markdown"><p>Splits the execution pipeline. Returns a fixture that will sequence through the provided seq of fixture fns and pass the context in turn.</p>
<p>Thus, any fixtures further down the fixture pipeline will be invoked multiple times.</p></div></div></div><div class="public anchor" id="var-spy"><h3>spy</h3><h4 class="type">macro</h4><div class="usage"><code>(spy spy-var)</code><code>(spy spy-var mock-fn)</code></div><div class="doc"><div class="markdown"><p>Mocks a function with a spy. The spy records into an atom each set of arguments it is passed, before passing the arguments to the mock function.</p>
<p>A mock function can also be supplied.</p>
<p>Usage:</p>
<pre><code>  (with-spy db/put-row (fn [_ row-data] ...))
</code></pre>
<p>The <a href="com.walmartlabs.test-fixtures.html#var-calls">calls</a> macro retrieves the calls made to the spy.</p></div></div></div><div class="public anchor" id="var-update-in-context"><h3>update-in-context</h3><div class="usage"><code>(update-in-context ks f &amp; args)</code></div><div class="doc"><div class="markdown"><p>Returns a fixture that performs an <code>update-in</code> on the context during execution.</p></div></div></div></div></body></html>