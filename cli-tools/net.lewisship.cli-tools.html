<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>net.lewisship.cli-tools documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">io.github.hlship/cli-tools</span> <span class="project-version">0.6</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="net.lewisship.cli-tools.html"><div class="inner"><span>net.lewisship.cli-tools</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-best-match"><div class="inner"><span>best-match</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-defcommand"><div class="inner"><span>defcommand</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-dispatch"><div class="inner"><span>dispatch</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-dispatch*"><div class="inner"><span>dispatch*</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-exit"><div class="inner"><span>exit</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-help"><div class="inner"><span>help</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-locate-commands"><div class="inner"><span>locate-commands</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-print-summary"><div class="inner"><span>print-summary</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-set-prevent-exit.21"><div class="inner"><span>set-prevent-exit!</span></div></a></li><li class="depth-1"><a href="net.lewisship.cli-tools.html#var-sorted-name-list"><div class="inner"><span>sorted-name-list</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">net.lewisship.cli-tools</h1><div class="doc"><div class="markdown"><p>Utilities for create CLIs around functions, and creating tools with multiple sub-commands.</p>
</div></div><div class="public anchor" id="var-best-match"><h3>best-match</h3><div class="usage"><code>(best-match input values)</code></div><div class="doc"><div class="markdown"><p>Given an input string and a seq of possible values, returns the matching value if it can be uniquely identified.</p>
<p>values may be strings, symbols, or keywords.</p>
<p>best-match does a caseless substring match against the provided values. It returns the single value that matches the input. It returns nil if no value matches, or if multiple values match.</p>
<p>Some special handling for the <code>-</code> character; the input value is split on <code>-</code> and turned into a generous regular expression that matches the substring on either side of the <code>-</code> as well as the <code>-</code> itself.</p>
<p>Returns the string/symbol/keyword from values.</p>
<p>e.g. <code>:parse-fn #(cli-tools/best-match % #{:red :green :blue})</code> would parse an input of <code>red</code> to <code>:red</code>, or an input of <code>b</code> to <code>:blue</code>; <code>z</code> matches nothing and returns nil, as would <code>e</code> which matches multiple values.</p>
<p>Expects symbols and keywords to be unqualified.</p>
</div></div></div><div class="public anchor" id="var-defcommand"><h3>defcommand</h3><h4 class="type">macro</h4><div class="usage"><code>(defcommand command-name docstring interface &amp; body)</code></div><div class="doc"><div class="markdown"><p>Defines a command.</p>
<p>A command’s <em>interface</em> identifies how to parse command options and positional arguments, mapping them to local symbols.</p>
<p>Commands must always have a docstring; this is part of the <code>-h</code> / <code>--help</code> summary.</p>
<p>The returned function is variadic, accepting a number of strings, much like a <code>-main</code> function. For testing purposes, it may instead be passed a single map, a command map, which bypasses parsing of the arguments, and is used only for testing.</p>
<p>Finally, the body inside a let that destructures the options and positional arguments into local symbols.</p>
</div></div></div><div class="public anchor" id="var-dispatch"><h3>dispatch</h3><div class="usage"><code>(dispatch options)</code></div><div class="doc"><div class="markdown"><p>Locates commands in namespaces, finds the current command (as identified by the first command line argument) and processes CLI options and arguments.</p>
<p>options:</p>
<ul>
<li>:tool-name (optional, string) - used in command summary and errors</li>
<li>:tool-doc (optional, string) - used in help summary</li>
<li>:arguments - command line arguments to parse (defaults to <em>command-line-args</em>)</li>
<li>:namespaces - symbols identifying namespaces to search for commands</li>
</ul>
<p>The :tool-name option is only semi-optional; in a Babashka script, it will default from the <code>babashka.file</code> system property, if any. An exception is thrown if :tool-name is not provided and can’t be defaulted.</p>
<p>The default for :tool-doc is the docstring of the first namespace.</p>
<p>dispatch will load any namespaces specified, then scan those namespaces to identify commands. It also adds a <code>help</code> command from this namespace.</p>
<p>If option and argument parsing is unsuccessful, then a command usage summary is printed, along with errors, and the program exits with error code 1.</p>
<p>dispatch simply loads and scans the namespaces, adds the <code>help</code> command, then calls <a href="net.lewisship.cli-tools.html#var-dispatch*">dispatch*</a>.</p>
<p>Returns nil.</p>
</div></div></div><div class="public anchor" id="var-dispatch*"><h3>dispatch*</h3><div class="usage"><code>(dispatch* options)</code></div><div class="doc"><div class="markdown"><p>Invoked by <a href="net.lewisship.cli-tools.html#var-dispatch">dispatch</a> after namespace and command resolution.</p>
<p>This can be used, for example, to avoid including the builtin help command (or when providing an override).</p>
<p>options:</p>
<ul>
<li>:tool-name - used in command summary and errors</li>
<li>:tool-doc - used in command summary</li>
<li>:arguments - seq of strings; first is name of command, rest passed to command</li>
<li>:commands - map from string command name to a var (defined via <a href="net.lewisship.cli-tools.html#var-defcommand">defcommand</a>)</li>
</ul>
<p>All options are required.</p>
<p>Returns nil.</p>
</div></div></div><div class="public anchor" id="var-exit"><h3>exit</h3><div class="usage"><code>(exit status)</code></div><div class="doc"><div class="markdown"><p>An indirect call to System/exit, passing a numeric status code (0 for success, non-zero for an error).</p>
<p>This is provided so that, during testing, when <a href="net.lewisship.cli-tools.html#var-set-prevent-exit.21">set-prevent-exit!</a> has been called, the call to <code>exit</code> will instead throw an exception.</p>
</div></div></div><div class="public anchor" id="var-help"><h3>help</h3><div class="usage"><code>(help &amp; args)</code></div><div class="doc"><div class="markdown"><p>List available commands</p>
</div></div></div><div class="public anchor" id="var-locate-commands"><h3>locate-commands</h3><div class="usage"><code>(locate-commands namespace-symbols)</code></div><div class="doc"><div class="markdown"><p>Passed a seq of symbols identifying <em>loaded</em> namespaces, this function locates commands, functions defined by <a href="net.lewisship.cli-tools.html#var-defcommand">defcommand</a>.</p>
<p>Normally, this is called from <a href="net.lewisship.cli-tools.html#var-dispatch">dispatch</a> and is only needed when calling <a href="net.lewisship.cli-tools.html#var-dispatch*">dispatch*</a> directly.</p>
<p>Returns a map from string command name to command Var.</p>
</div></div></div><div class="public anchor" id="var-print-summary"><h3>print-summary</h3><div class="usage"><code>(print-summary command-map errors)</code></div><div class="doc"><div class="markdown"><p>Prints the command’s summary to <code>*out*</code>; partially generated by clojure.tools.cli, and then enhanced with more information about positional command line arguments.</p>
<p>This is often used when a command performs additional validation of its arguments and needs to output the summary and errors on failure.</p>
<p>Uses the command map that is available in <code>defcommand</code> function (using the :as clause).</p>
<p>errors is a seq of strings to display as errors.</p>
</div></div></div><div class="public anchor" id="var-set-prevent-exit.21"><h3>set-prevent-exit!</h3><div class="usage"><code>(set-prevent-exit! flag)</code></div><div class="doc"><div class="markdown"><p>Normally, after displaying a command summary, <code>System/exit</code> is called (with 0 if for –help, or 1 if a validation error).</p>
<p>For testing purposes, this can be prevented; instead, an exception is thrown, with message “Exit” and ex-data {:status <status>}.</status></p>
</div></div></div><div class="public anchor" id="var-sorted-name-list"><h3>sorted-name-list</h3><div class="usage"><code>(sorted-name-list values)</code></div><div class="doc"><div class="markdown"><p>Converts a seq of strings, keywords, or symbols (as used with <a href="net.lewisship.cli-tools.html#var-best-match">best-match</a>) to a comma-separated string listing the values. This is often used with help summary or error messages related.</p>
</div></div></div></div></body></html>